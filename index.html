<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Birthday Guddu ‚ù§Ô∏è</title>

  <style>
    :root{
      --glass: rgba(255,255,255,0.78);
      --shadow: 0 16px 44px rgba(0,0,0,0.14);
      --accent: #ff3b7a;
      --accent2: #ff7aa6;
      --text: #1b1b1b;
    }

    *{ box-sizing: border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;

      background:
        radial-gradient(900px 500px at 20% 10%, rgba(255, 77, 136, 0.22), transparent 60%),
        radial-gradient(900px 500px at 80% 20%, rgba(90, 200, 250, 0.22), transparent 60%),
        linear-gradient(135deg, #ffe1ee, #dff4ff);
    }

    /* Floating hearts */
    .hearts{
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
    }
    .heart{
      position: absolute;
      left: 0;
      top: -10vh;
      font-size: 18px;
      opacity: 0.9;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,0.1));
      animation: fall linear forwards;
      transform: translate3d(0,0,0);
      will-change: transform, opacity;
    }
    @keyframes fall{
      0%   { transform: translate(var(--x), -10vh) rotate(0deg); opacity: 0; }
      10%  { opacity: 0.95; }
      100% { transform: translate(calc(var(--x) + var(--drift)), 110vh) rotate(var(--rot)); opacity: 0; }
    }

    /* Heart wipe overlay */
    .heartWipe{
      position: fixed;
      inset: 0;
      z-index: 100;
      display: none;
      place-items: center;
      pointer-events: none;
    }
    .heartWipe::before{
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(16, 10, 14, 0.28);
      backdrop-filter: blur(6px);
      opacity: 0;
    }
    .heartSvg{
      width: min(50vmin, 420px);
      height: auto;
      filter: drop-shadow(0 18px 45px rgba(0,0,0,0.25));
      transform: scale(0.05);
      opacity: 0;
      fill: var(--accent);
    }
    .heartWipe.active{
      display: grid;
    }
    .heartWipe.active::before{
      animation: dimBg 900ms cubic-bezier(.22,1,.36,1) forwards;
    }
    .heartWipe.active .heartSvg{
      animation: heartPopWipe 900ms cubic-bezier(.22,1,.36,1) forwards;
    }
    @keyframes dimBg{
      0% { opacity: 0; }
      45%{ opacity: 1; }
      100%{ opacity: 0; }
    }
    @keyframes heartPopWipe{
      0%   { transform: scale(0.08); opacity: 0; }
      25%  { transform: scale(1.0); opacity: 1; }
      55%  { transform: scale(1.8); opacity: 1; }
      100% { transform: scale(15); opacity: 0; }
    }

    /* Start overlay */
    .overlay{
      position: fixed;
      inset: 0;
      z-index: 50;
      background: rgba(16, 10, 14, 0.34);
      display: grid;
      place-items: center;
      padding: 22px;
      backdrop-filter: blur(7px);
    }
    .overlayCard{
      width: min(560px, 92vw);
      background: rgba(255,255,255,0.88);
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.7);
      box-shadow: 0 22px 60px rgba(0,0,0,0.25);
      padding: 20px 18px 18px;
      text-align: center;
    }
    .overlayCard .emoji{ font-size: 40px; }
    .overlayCard h2{
      margin: 8px 0 0;
      font-size: 20px;
    }
    .overlayCard p{
      margin: 10px 0 0;
      font-size: 14px;
      opacity: 0.86;
      line-height: 1.55;
    }

    /* Greeting card container */
    .cardWrap{
      position: relative;
      z-index: 1;
      width: min(980px, 92vw);
      margin: 26px auto 56px;
    }
    .card{
      background: var(--glass);
      border-radius: 26px;
      border: 1px solid rgba(255,255,255,0.65);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow: hidden;
      min-height: 72vh;
      display: flex;
      flex-direction: column;
    }

    /* Pages with smooth fade-in */
    .page{
      display: none;
      padding: 22px 18px 18px;
      flex: 1;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 600ms ease, transform 600ms ease;
    }
    .page.active{
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    /* subtle glow only on last page */
    .page.endGlow{
      background: radial-gradient(
        600px 300px at 50% 20%,
        rgba(255, 122, 166, 0.18),
        transparent 70%
      );
    }

    .pageInner{
      max-width: 860px;
      margin: 0 auto;
    }

    /* Buttons */
    .btnRow{
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      padding: 0 18px 18px;
    }
    .btn{
      border: none;
      border-radius: 999px;
      padding: 12px 18px;
      cursor: pointer;
      font-size: 14.5px;
      background: rgba(255,255,255,0.82);
      box-shadow: 0 16px 40px rgba(0,0,0,0.12);
      backdrop-filter: blur(8px);
      transition: transform 120ms ease, opacity 120ms ease;
    }
    .btn:active{ transform: scale(0.98); }
    .btn.primary{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: #fff;
      box-shadow: 0 18px 44px rgba(255, 59, 122, 0.32);
    }

    /* Page 1: title animations */
    .hero{
      text-align: center;
      padding: 18px 10px 6px;
    }
    .title{
      margin: 0;
      font-size: clamp(38px, 5.4vw, 64px);
      letter-spacing: 0.2px;
      position: relative;
      display: inline-block;
    }
    .title .shine{
      background: linear-gradient(90deg, #1b1b1b, var(--accent), #1b1b1b);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      background-size: 220% 100%;
      animation: shimmer 3.6s ease-in-out infinite;
    }
    @keyframes shimmer{
      0%{ background-position: 0% 50%; }
      50%{ background-position: 100% 50%; }
      100%{ background-position: 0% 50%; }
    }

    .subline{
      margin: 12px auto 0;
      max-width: 720px;
      font-size: 16.5px;
      line-height: 1.65;
      opacity: 0.92;
    }

    /* little floating glow orbs */
    .orbs{
      position: relative;
      height: 160px;
      margin-top: 14px;
    }
    .orb{
      position: absolute;
      width: 110px;
      height: 110px;
      border-radius: 999px;
      filter: blur(2px);
      opacity: 0.65;
      animation: floaty 6.5s ease-in-out infinite;
      box-shadow: 0 20px 60px rgba(0,0,0,0.08);
    }
    .orb.one{ left: 10%; top: 22px; background: rgba(255, 59, 122, 0.25); animation-delay: 0s; }
    .orb.two{ left: 42%; top: 0px;  background: rgba(90, 200, 250, 0.26); animation-delay: 0.8s; }
    .orb.three{ right: 12%; top: 34px; background: rgba(255, 122, 166, 0.25); animation-delay: 1.6s; }
    @keyframes floaty{
      0%,100%{ transform: translateY(0) scale(1); }
      50%{ transform: translateY(-16px) scale(1.05); }
    }

    /* Page 2: message */
    .messageBlock{ padding: 10px 8px 0; }
    .messageBlock h2{
      margin: 0;
      text-align: center;
      font-size: 18px;
      opacity: 0.92;
    }
    .letter{
      margin: 14px auto 0;
      max-width: 820px;
      padding: 18px 16px;
      border-radius: 20px;
      background: rgba(255,255,255,0.78);
      border: 1px solid rgba(255,255,255,0.7);
      box-shadow: 0 14px 34px rgba(0,0,0,0.10);
      line-height: 1.75;
      font-size: 16px;
      white-space: pre-line;
    }

    /* Page 3: portrait slideshow */
    .sectionHead{
      display:flex;
      justify-content: space-between;
      align-items: baseline;
      flex-wrap: wrap;
      gap: 10px;
      padding: 6px 6px 0;
      max-width: 860px;
      margin: 0 auto;
    }
    .sectionHead h2{ margin:0; font-size: 18px; }
    .sectionHead .hint{ font-size: 13px; opacity: 0.8; }

    .slider{
      position: relative;
      margin: 14px auto 0;
      width: 100%;
      max-width: 900px;
      height: min(55vh, 520px);
      background: linear-gradient(180deg, #ffffff, #f7f7f7);
      border-radius: 22px;
      overflow: hidden;
      box-shadow: 0 16px 40px rgba(0,0,0,0.12);
      border: 1px solid rgba(255,255,255,0.65);
    }

    .slide{
      position: absolute;
      inset: 0;
      opacity: 0;
      transform: scale(1.02);
      transition: opacity 650ms ease, transform 900ms ease;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px;
    }
    .slide.active{
      opacity: 1;
      transform: scale(1);
    }

    .slide img{
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
      max-width: 70%;
      max-height: 100%;
      border-radius: 18px;
      box-shadow: 0 16px 38px rgba(0,0,0,0.12);
      background: white;
    }

    .caption{
      position:absolute;
      left: 14px;
      right: 14px;
      bottom: 14px;
      padding: 12px 14px;
      border-radius: 18px;
      background: rgba(255,255,255,0.86);
      box-shadow: 0 12px 26px rgba(0,0,0,0.12);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.7);
      font-size: 14px;
      line-height: 1.45;
      text-align: center;
    }

    .controls{
      display:flex;
      justify-content:center;
      align-items:center;
      gap: 10px;
      padding: 14px 10px 0;
      flex-wrap: wrap;
    }
    .dots{ display:flex; gap: 8px; align-items:center; }
    .dot{
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: rgba(0,0,0,0.22);
      border: 1px solid rgba(255,255,255,0.7);
      cursor: pointer;
      transition: transform 120ms ease, background 120ms ease;
    }
    .dot.active{
      background: rgba(255, 59, 122, 0.9);
      transform: scale(1.2);
    }

    /* Page 4: ending */
    .end{ text-align: center; padding: 18px 8px 0; }
    .end h2{ margin: 0; font-size: 20px; }
    .endCard{
      margin: 14px auto 0;
      max-width: 820px;
      padding: 18px 16px;
      border-radius: 22px;
      background: rgba(255,255,255,0.82);
      border: 1px solid rgba(255,255,255,0.7);
      box-shadow: 0 16px 40px rgba(0,0,0,0.12);
      line-height: 1.75;
      font-size: 16px;
      white-space: pre-line;
    }

    /* Age box (animated) */
    .ageBox{ margin-top: 16px; text-align: center; }
    .bornText{ font-size: 14px; opacity: 0.85; }
    .ageText{ margin-top: 8px; font-size: 15px; opacity: 0.9; }
    .ageValue{
      margin-top: 6px;
      font-size: 20px;
      font-weight: 650;
      letter-spacing: 0.3px;
      transition: filter 250ms ease;
    }
    .ageSmall{ margin-top: 8px; font-size: 13px; opacity: 0.85; }
    .ageValue.animate{
      animation: agePop 420ms ease;
      filter: drop-shadow(0 10px 18px rgba(255, 59, 122, 0.25));
    }
    @keyframes agePop{
      0%   { transform: scale(0.98); opacity: 0.75; }
      40%  { transform: scale(1.04); opacity: 1; }
      100% { transform: scale(1); }
    }

    .tiny{
      text-align:center;
      font-size: 12.5px;
      opacity: 0.75;
      padding: 8px 18px 0;
    }

    @media (max-width: 520px){
      .slide img{ max-width: 88%; }
      .card{ min-height: 78vh; }
    }

    @media (prefers-reduced-motion: reduce){
      .heart, .slide, .title .shine, .orb, .heartWipe.active::before, .heartWipe.active .heartSvg{ animation: none !important; transition: none !important; }
      .btn{ transition: none !important; }
    }
  </style>
</head>

<body>
  <div class="hearts" id="hearts"></div>

  <!-- Heart wipe transition overlay -->
  <div class="heartWipe" id="heartWipe" aria-hidden="true">
    <svg viewBox="0 0 512 512" class="heartSvg" aria-hidden="true">
      <path d="M256 464s-44.8-26.4-89.6-63.2C96 350.4 32 286.4 32 196.8 32 129.6 81.6 80 148.8 80c35.2 0 68.8 16 89.6 41.6C259.2 96 292.8 80 328 80 395.2 80 444.8 129.6 444.8 196.8c0 89.6-64 153.6-134.4 204.8C300.8 437.6 256 464 256 464z"/>
    </svg>
  </div>

  <!-- START OVERLAY -->
  <div class="overlay" id="overlay">
    <div class="overlayCard">
      <div class="emoji">üíù</div>
      <h2>Ready for the surprise?</h2>
      <p>Tap the button and your greeting card will begin‚Ä¶ with music ‚ú®</p>
      <div style="margin-top:14px;">
        <button class="btn primary" id="startBtn">Ready for surprise? ‚ù§Ô∏è</button>
      </div>
      <p style="margin-top:10px; font-size:12.5px; opacity:0.75;">
        (You can pause the song anytime.)
      </p>
    </div>
  </div>

  <!-- AUDIO -->
  <audio id="song" src="song/favorite.mp3" preload="auto"></audio>

  <!-- GREETING CARD -->
  <div class="cardWrap">
    <div class="card">

      <!-- PAGE 1 -->
      <div class="page active" id="page1">
        <div class="pageInner hero">
          <h1 class="title"><span class="shine">Happy Birthday Guddu</span> ‚ù§Ô∏è</h1>
          <p class="subline">
            I made this little greeting card just for you. Tap next‚Ä¶ and keep tapping until the end üíó
          </p>

          <div class="orbs" aria-hidden="true">
            <div class="orb one"></div>
            <div class="orb two"></div>
            <div class="orb three"></div>
          </div>

          <!-- AGE (animated) -->
          <div class="ageBox">
            <div class="bornText">
              She was born on <strong>18 February 2002</strong> at <strong>12:59 PM</strong>
            </div>
            <div class="ageText">
              And she‚Äôs been making the world better for
            </div>
            <div class="ageValue" id="ageValue">calculating‚Ä¶</div>
            <div class="ageSmall">
              ‚Ä¶and I‚Äôm grateful for every bit of it ‚ù§Ô∏è
            </div>
          </div>
        </div>
      </div>

      <!-- PAGE 2 -->
      <div class="page" id="page2">
        <div class="pageInner messageBlock">
          <h2>For you, Guddu üíñ</h2>
          <div class="letter" id="customMessage"></div>
          <div class="tiny">Turn the page when you‚Äôre ready‚Ä¶</div>
        </div>
      </div>

      <!-- PAGE 3 -->
      <div class="page" id="page3">
        <div class="sectionHead">
          <h2>Our memories üíû</h2>
          <div class="hint">Auto-slides every 4 seconds ‚Ä¢ swipe on mobile</div>
        </div>

        <div class="slider" id="slider">
          <div class="slide active">
            <img src="photos/Guddu CA.jpeg" alt="Memory 1">
          </div>
          <div class="slide">
            <img src="photos/Guddu Hug.jpeg" alt="Memory 2">
          </div>
          <div class="slide">
            <img src="photos/Guddu.jpeg" alt="Memory 3">
          </div>
          <div class="slide">
            <img src="photos/Guddu kiss.jpeg" alt="Memory 4">
          </div>
          <div class="slide">
            <img src="photos/Guddu DP.jpeg" alt="Memory 5">
          </div>

          <div class="caption" id="caption">‚Äú ‚Äù</div>
        </div>

        <div class="controls">
          <button class="btn" id="prevBtn">‚¨Ö Prev</button>
          <button class="btn primary" id="toggleAutoBtn">‚è∏ Pause slideshow</button>
          <button class="btn" id="nextBtn">Next ‚û°</button>
          <div class="dots" id="dots"></div>
        </div>

        <div class="tiny">One more page‚Ä¶</div>
      </div>

      <!-- PAGE 4 -->
      <div class="page" id="page4">
        <div class="pageInner end">
          <h2>For my favourite girl ‚ù§Ô∏è</h2>
          <div class="endCard" id="endText"></div>
        </div>
      </div>

      <!-- NAV BUTTONS -->
      <div class="btnRow">
        <button class="btn" id="backBtn" style="display:none;">‚¨Ö Back</button>
        <button class="btn primary" id="nextPageBtn">Next üíó</button>
        <button class="btn" id="toggleMusicBtn" style="display:none;">‚è∏ Pause song</button>
      </div>
    </div>
  </div>

  <script>
    /***********************
     * CONTENT
     ***********************/
    const FULL_MESSAGE = `Guddu,

From the moment you came into my life, everything quietly changed.
Not all at once. Not loudly. But in the most beautiful way possible.

You became the calm in my chaos, the smile I look for without realizing it, the thought that makes ordinary moments feel special. With you, even silence feels warm. Even distance feels bearable. Even difficult days feel lighter, just knowing you exist in my world.

Loving you has never felt like effort. It feels like instinct. Like something my heart already knew how to do long before I understood it. Every version of me is better because of you. Kinder. Stronger. More hopeful. More alive.

I feel incredibly lucky to have you in my life, Guddu. Lucky in a way that words don‚Äôt fully capture. Lucky to love you. Lucky to be loved by you. Lucky to wake up every day knowing that somewhere in this world, you are there, being exactly who you are.

You are not just someone I love.
You are someone I choose. Every day. In every way.

And I hope you always remember this:
You are deeply cherished. You are profoundly important. And you are loved more than you probably realize.`;

    const LAST_LINE = `From the guy who has loved you like crazy and will keep loving you more and more.
Once again, Happiest Birthday, my love ‚ù§Ô∏è`;

    const END_EXTRA = `If I could wrap my love into something you could hold,
it would feel like warmth on your cold days,
and like peace on your busiest ones.
It would feel like reassurance when you doubt yourself,
and like a quiet smile when words fall short.

Today, I‚Äôm not just wishing you a happy birthday.
I‚Äôm wishing you a life that feels as beautiful as your heart.
A life filled with moments that feel gentle,
with dreams that feel possible,
and with love that never makes you question your worth.

And in all those wishes, I find one for myself too,
soft and honest and certain‚Ä¶
to keep choosing you,
to keep growing with you,
and to walk through whatever comes next,
side by side.

Quietly, deeply, and always‚Ä¶
a lifetime with you.`;

    const CAPTIONS = [
      "‚ÄúVery special moment, seeing you achieve everything you worked hard for.‚Äù",
      "‚ÄúIf I had one wish, I‚Äôd choose you again and again.‚Äù",
      "‚ÄúYour smile is my favourite place to be.‚Äù",
      "‚ÄúYou + me = my happiest chapter.‚Äù",
      "‚ÄúToday I celebrate you‚Ä¶ always.‚Äù"
    ];

    /***********************
     * SET MESSAGE CONTENT
     ***********************/
    document.getElementById("customMessage").textContent = FULL_MESSAGE;
    document.getElementById("endText").textContent = `${LAST_LINE}\n\n${END_EXTRA}`;

    /***********************
     * HEART WIPE TRANSITION
     ***********************/
    const heartWipe = document.getElementById("heartWipe");
    let isTransitioning = false;

    function heartTransition(callback){
      if (isTransitioning) return;
      isTransitioning = true;

      heartWipe.classList.add("active");

      setTimeout(() => { callback(); }, 450);

      setTimeout(() => {
        heartWipe.classList.remove("active");
        isTransitioning = false;
      }, 950);
    }

    /***********************
     * PAGE FLOW
     ***********************/
    const overlay = document.getElementById("overlay");
    const startBtn = document.getElementById("startBtn");

    const pages = [
      document.getElementById("page1"),
      document.getElementById("page2"),
      document.getElementById("page3"),
      document.getElementById("page4"),
    ];
    let pageIndex = 0;

    const backBtn = document.getElementById("backBtn");
    const nextPageBtn = document.getElementById("nextPageBtn");
    const toggleMusicBtn = document.getElementById("toggleMusicBtn");

    function showPage(i){
      pages.forEach((p, idx) => {
        p.classList.toggle("active", idx === i);
        p.classList.toggle("endGlow", idx === pages.length - 1 && idx === i);
      });

      pageIndex = i;

      backBtn.style.display = (pageIndex === 0) ? "none" : "inline-flex";
      nextPageBtn.textContent = (pageIndex === pages.length - 1) ? "Replay üíû" : "Next üíó";
      toggleMusicBtn.style.display = started ? "inline-flex" : "none";

      if (pageIndex === 2) startAuto(true);
      else stopAuto();

      for (let k=0; k<4; k++) spawnHeart();

      if (pageIndex === pages.length - 1) {
        for (let j = 0; j < 18; j++) {
          setTimeout(spawnHeart, j * 120);
        }
      }
    }

    nextPageBtn.addEventListener("click", () => {
      if (isTransitioning) return;
      const target = (pageIndex === pages.length - 1) ? 0 : (pageIndex + 1);

      heartTransition(() => {
        showPage(target);
        window.scrollTo({ top: 0, behavior: "smooth" });
      });
    });

    backBtn.addEventListener("click", () => {
      if (isTransitioning) return;
      const target = Math.max(0, pageIndex - 1);

      heartTransition(() => {
        showPage(target);
        window.scrollTo({ top: 0, behavior: "smooth" });
      });
    });

    /***********************
     * MUSIC
     ***********************/
    const song = document.getElementById("song");
    let started = false;

    async function playSong(){
      try{
        await song.play();
        toggleMusicBtn.textContent = "‚è∏ Pause song";
      } catch (e){
        toggleMusicBtn.textContent = "‚ñ∂ Play song";
      }
    }

    function pauseSong(){
      song.pause();
      toggleMusicBtn.textContent = "‚ñ∂ Play song";
    }

    toggleMusicBtn.addEventListener("click", async () => {
      if (song.paused) await playSong();
      else pauseSong();
    });

    async function startExperience(){
      overlay.style.display = "none";
      started = true;
      toggleMusicBtn.style.display = "inline-flex";
      startHearts();
      await playSong();
      showPage(0);
    }
    startBtn.addEventListener("click", startExperience);

    /***********************
     * AGE (animated)
     ***********************/
    const birthDate = new Date(2002, 1, 18, 12, 59); // Feb=1 (0-based)
    const ageValue = document.getElementById("ageValue");
    let lastAgeText = "";

    function calculateAge(){
      const now = new Date();

      let years = now.getFullYear() - birthDate.getFullYear();
      let months = now.getMonth() - birthDate.getMonth();
      let days = now.getDate() - birthDate.getDate();
      let hours = now.getHours() - birthDate.getHours();
      let minutes = now.getMinutes() - birthDate.getMinutes();

      if (minutes < 0) { minutes += 60; hours--; }
      if (hours < 0) { hours += 24; days--; }
      if (days < 0) {
        const prevMonth = new Date(now.getFullYear(), now.getMonth(), 0);
        days += prevMonth.getDate();
        months--;
      }
      if (months < 0) { months += 12; years--; }

      const newText = `${years} years, ${months} months, ${days} days, ${hours} hours, ${minutes} minutes`;

      if (newText !== lastAgeText) {
        ageValue.textContent = newText;
        ageValue.classList.remove("animate");
        void ageValue.offsetWidth;
        ageValue.classList.add("animate");
        lastAgeText = newText;
      }
    }
    calculateAge();
    setInterval(calculateAge, 60 * 1000);

    /***********************
     * HEARTS
     ***********************/
    const heartsLayer = document.getElementById("hearts");
    const heartChars = ["‚ù§Ô∏è","üíó","üíñ","üíï","üíû","üíò"];
    let heartsTimer = null;

    function spawnHeart(){
      const h = document.createElement("div");
      h.className = "heart";
      h.textContent = heartChars[Math.floor(Math.random()*heartChars.length)];
      const x = Math.random() * 100;
      const drift = (Math.random()*30 - 15);
      const rot = (Math.random()*220 - 110);
      const size = 14 + Math.random()*18;
      const dur = 6 + Math.random()*7;
      const delay = Math.random()*0.6;

      h.style.setProperty("--x", x + "vw");
      h.style.setProperty("--drift", drift + "vw");
      h.style.setProperty("--rot", rot + "deg");
      h.style.fontSize = size + "px";
      h.style.animationDuration = dur + "s";
      h.style.animationDelay = delay + "s";

      heartsLayer.appendChild(h);
      setTimeout(() => h.remove(), (dur + delay + 0.2) * 1000);
    }

    function startHearts(){
      if (heartsTimer) return;
      heartsTimer = setInterval(() => {
        spawnHeart();
        if (Math.random() < 0.45) spawnHeart();
      }, 520);
    }

    /***********************
     * SLIDESHOW
     ***********************/
    const slides = Array.from(document.querySelectorAll(".slide"));
    const captionEl = document.getElementById("caption");
    const dotsEl = document.getElementById("dots");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const toggleAutoBtn = document.getElementById("toggleAutoBtn");
    const slider = document.getElementById("slider");

    let sIndex = 0;
    let auto = true;
    let autoTimer = null;

    function buildDots(){
      dotsEl.innerHTML = "";
      slides.forEach((_, i) => {
        const dot = document.createElement("div");
        dot.className = "dot" + (i === sIndex ? " active" : "");
        dot.addEventListener("click", () => goTo(i, true));
        dotsEl.appendChild(dot);
      });
    }

    function setActive(i){
      slides.forEach((s, k) => s.classList.toggle("active", k === i));
      captionEl.textContent = CAPTIONS[i] || "‚Äú ‚Äù";
      sIndex = i;
      Array.from(dotsEl.children).forEach((d, k) => d.classList.toggle("active", k === sIndex));
    }

    function goTo(i, userAction=false){
      if (i < 0) i = slides.length - 1;
      if (i >= slides.length) i = 0;
      setActive(i);
      if (userAction && auto) startAuto(true);
    }

    function startAuto(reset=false){
      if (reset && autoTimer){
        clearInterval(autoTimer);
        autoTimer = null;
      }
      if (!auto) return;
      if (autoTimer) return;
      autoTimer = setInterval(() => goTo(sIndex + 1), 4000);
    }

    function stopAuto(){
      if (autoTimer){
        clearInterval(autoTimer);
        autoTimer = null;
      }
    }

    prevBtn.addEventListener("click", () => goTo(sIndex - 1, true));
    nextBtn.addEventListener("click", () => goTo(sIndex + 1, true));

    toggleAutoBtn.addEventListener("click", () => {
      auto = !auto;
      if (auto){
        toggleAutoBtn.textContent = "‚è∏ Pause slideshow";
        startAuto(true);
      } else {
        toggleAutoBtn.textContent = "‚ñ∂ Resume slideshow";
        stopAuto();
      }
    });

    // swipe support
    let touchStartX = null;
    slider.addEventListener("touchstart", (e) => {
      touchStartX = e.changedTouches[0].clientX;
    }, { passive: true });

    slider.addEventListener("touchend", (e) => {
      if (touchStartX === null) return;
      const dx = e.changedTouches[0].clientX - touchStartX;
      touchStartX = null;
      if (Math.abs(dx) > 40){
        if (dx > 0) goTo(sIndex - 1, true);
        else goTo(sIndex + 1, true);
      }
    }, { passive: true });

    buildDots();
    setActive(0);
    showPage(0);

    // light heart burst on scroll
    let lastBurst = 0;
    window.addEventListener("scroll", () => {
      const t = Date.now();
      if (t - lastBurst < 700) return;
      lastBurst = t;
      for (let i=0; i<3; i++) spawnHeart();
    }, { passive: true });
  </script>
</body>
</html>

